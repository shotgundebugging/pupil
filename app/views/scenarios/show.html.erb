
<h1><%= @scenario.name %></h1>

<p><%= simple_format(@scenario.description) %></p>

<% if @scenario.rgb_video.attached? || @scenario.depth_video.attached? %>
  <div
    data-controller="synced-videos"
    data-synced-videos-fps-value="30">

    <div class="flex gap-4">
      <% if @scenario.rgb_video.attached? %>
        <video
          data-synced-videos-target="rgb"
          preload="auto"
          width="424"
          height="240">
          <source src="<%= url_for(@scenario.rgb_video) %>" type="video/mp4">
        </video>
      <% else %>
        <p>No RGB video uploaded.</p>
      <% end %>

      <% if @scenario.depth_video.attached? %>
        <video
          data-synced-videos-target="depth"
          preload="auto"
          width="424"
          height="240">
          <source src="<%= url_for(@scenario.depth_video) %>" type="video/mp4">
        </video>
      <% else %>
        <p>No depth video uploaded.</p>
      <% end %>
    </div>

    <div class="mt-4 flex items-center gap-2">
      <button data-action="click->synced-videos#togglePlay">
        Play/Pause
      </button>

      <input type="range"
             min="0" max="100" value="0" step="0.01"
             data-synced-videos-target="slider"
             data-action="input->synced-videos#seek">

      Time:
      <span data-synced-videos-target="timeDisplay"></span>
      |
      <span data-synced-videos-target="frameDisplay"></span>
    </div>

    <hr class="my-4">

    <div
      data-controller="annotations"
      data-annotations-create-url-value="<%= scenario_annotations_path(@scenario) %>"
      data-action="frame-changed@document->annotations#onFrameChanged">

      <h2>Annotation canvas (RGB frame snapshot area)</h2>
      <canvas
        data-annotations-target="canvas"
        width="848"
        height="480"
        style="border: 1px solid #ccc;">
      </canvas>

      <div class="mt-2">
        <label for="annotation_label">Label:</label>
        <select id="annotation_label" data-annotations-target="labelSelect">
          <% ["sidewalk", "curb", "stair", "obstacle", "car", "person"].each do |label| %>
            <option value="<%= label %>"><%= label %></option>
          <% end %>
        </select>

        <button
          class="ml-2"
          data-action="click->annotations#saveCurrentAnnotation">
          Save annotation
        </button>

        <button class="ml-2" data-action="click->annotations#clearAnnotation">Clear</button>

        <span class="ml-4" data-annotations-target="info">x: –, y: –, w: –, h: –</span>
      </div>

      <h2 class="mt-4">Annotations</h2>
      <turbo-frame id="annotations">
        <% if @scenario.annotations.any? %>
          <%= render @scenario.annotations %>
        <% else %>
          <p>No annotations yet.</p>
        <% end %>
      </turbo-frame>
    </div>
  </div>
<% else %>
  <p>No videos uploaded for this scenario.</p>
<% end %>

<p>
  <%= link_to "Back to scenarios", scenarios_path %>
</p>
